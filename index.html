<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My App Store</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

<!-- ðŸ”¹ NAVBAR -->
<a href="admin.html" class="btn btn-warning ms-2">Admin</a>
  <button class="btn btn-outline-light" onclick="logout()">Logout</button>

<nav class="navbar navbar-dark bg-dark">
  <div class="container">
    <span class="navbar-brand">My App Store</span>
    <a href="login.html" class="btn btn-outline-light">Login</a>
  </div>
</nav>

<!-- ðŸ”¹ MAIN CONTENT -->
<div class="container mt-5">
  <h2 class="mb-4">Available Apps</h2>

  <!-- ðŸ”¥ Apps yahan Firebase se aayengi -->
  <div id="apps" class="row"></div>
</div>

<!-- ðŸ”¥ FIREBASE SDKs -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

<!-- ðŸ”¥ Firebase Config -->
<script src="js/firebase.js"></script>

<!-- ðŸ”¥ LOAD APPS FROM FIRESTORE (ONLY ONCE) -->
<script>
  // Page load hote hi apps load karo
  document.addEventListener("DOMContentLoaded", function () {
    loadApps();
  });

  function loadApps() {
    const db = firebase.firestore();

    db.collection("apps")
      .where("active", "==", true)
      .get()
      .then(function (querySnapshot) {

        let html = "";

        if (querySnapshot.empty) {
          document.getElementById("apps").innerHTML =
            "<p>No apps available</p>";
          return;
        }

        querySnapshot.forEach(function (doc) {
          const app = doc.data();

          html += `
            <div class="col-md-4">
              <div class="card mb-4 shadow">
                <div class="card-body">
                  <h5 class="card-title">${app.name}</h5>
                  <p class="card-text">${app.desc}</p>
                  <button class="btn btn-primary"
                    onclick="startCheckout('${doc.id}')">
                    Buy â‚¹${app.price}
                  </button>
                </div>
              </div>
            </div>
          `;
        });

        document.getElementById("apps").innerHTML = html;
      })
      .catch(function (error) {
        console.error("Firestore error:", error);
      });
  }

  function startCheckout(appId) {
    if (!firebase.auth().currentUser) {
      window.location.href = "login.html";
    } else {
      window.location.href = "checkout.html?id=" + appId;
    }
  }
</script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="js/firebase.js"></script>
<script>
  function logout() {
    firebase.auth().signOut().then(function () {
      alert("Logged out successfully");
      window.location.href = "login.html";
    }).catch(function (error) {
      alert(error.message);
    });
  }
</script>

</body>
</html>
